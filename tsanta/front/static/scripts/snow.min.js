function SnowStorm(){function rnd(e,t){return isNaN(t)&&(t=0),Math.random()*e+t}function plusMinus(e){return 1==parseInt(rnd(2))?-1*e:e}var imagePath=imageDir?imageDir:"http://t-santa.ru/images/snow/",flakesMaxActive=sflakesMaxActive?sflakesMaxActive:32,vMaxX=svMaxX?svMaxX:2,vMaxY=svMaxY?svMaxY:3,usePNG=susePNG?susePNG:!0,flakeBottom=sflakeBottom?sflakeBottom:null,snowStick=ssnowStick?!0:!1,snowCollect=ssnowCollect?ssnowCollect:!1,targetElement=null,followMouse=sfollowMouse?sfollowMouse:!1,flakeTypes=sflakeTypes?sflakeTypes:5,flakeWidth=sflakeWidth?sflakeWidth:15,flakeHeight=sflakeHeight?sflakeHeight:15,zIndex=999,flakeLeftOffset=flakeWidth,flakeRightOffset=flakeWidth,addEvent=function(e,t,n){"undefined"==typeof attachEvent?e.addEventListener(t,n,!1):e.attachEvent("on"+t,n)},removeEvent=function(e,t,n){"undefined"==typeof attachEvent?e.removeEventListener(t,n,!1):e.detachEvent("on"+t,n)},s=this;this.timers=[],this.flakes=[],this.disabled=!1,this.terrain=[],this.active=!1;var isIE=navigator.userAgent.match(/msie/i),isIE6=navigator.userAgent.match(/msie 6/i),isOldIE=isIE&&(isIE6||navigator.userAgent.match(/msie 5/i)),isWin9X=navigator.appVersion.match(/windows 98/i),isiPhone=navigator.userAgent.match(/iphone/i),isBackCompatIE=isIE&&"BackCompat"==document.compatMode,isOpera=navigator.userAgent.match(/opera/i);isOpera&&(isIE=!1);var noFixed=isBackCompatIE||isIE6||isiPhone,screenX=null,screenX2=null,screenY=null,scrollY=null,vRndX=null,vRndY=null,windOffset=1,windMultiplier=2,pngSupported=!isIE||isIE&&!isIE6&&!isOldIE,docFrag=document.createDocumentFragment();this.oControl=null,null==flakeLeftOffset&&(flakeLeftOffset=0),null==flakeRightOffset&&(flakeRightOffset=0),this.randomizeWind=function(){if(vRndX=plusMinus(rnd(vMaxX,.2)),vRndY=rnd(vMaxY,.2),this.flakes)for(var e=0;e<this.flakes.length;e++)this.flakes[e].active&&this.flakes[e].setVelocities()},this.scrollHandler=function(){if(scrollY=flakeBottom?0:parseInt(window.scrollY||document.documentElement.scrollTop||document.body.scrollTop),isNaN(scrollY)&&(scrollY=0),!flakeBottom&&s.flakes)for(var e=0;e<s.flakes.length;e++)0==s.flakes[e].active&&s.flakes[e].stick()},this.resizeHandler=function(){window.innerWidth||window.innerHeight?(screenX=window.innerWidth-(isIE?2:16)-flakeRightOffset,screenY=flakeBottom?flakeBottom:window.innerHeight):(screenX=(document.documentElement.clientWidth||document.body.clientWidth||document.body.scrollWidth)-(isIE?0:8)-flakeRightOffset,screenY=flakeBottom?flakeBottom:document.documentElement.clientHeight||document.body.clientHeight||document.body.scrollHeight),screenX2=parseInt(screenX/2)},this.resizeHandlerAlt=function(){screenX=targetElement.offsetLeft+targetElement.offsetWidth-flakeRightOffset,screenY=flakeBottom?flakeBottom:targetElement.offsetTop+targetElement.offsetHeight,screenX2=parseInt(screenX/2)},this.freeze=function(){if(s.disabled)return!1;s.disabled=1;for(var e=0;e<s.timers.length;e++)clearInterval(s.timers[e])},this.resume=function(){return s.disabled?(s.disabled=0,s.timerInit(),void 0):!1},this.toggleSnow=function(){s.flakes.length?(s.active=!s.active,s.active?(s.show(),s.resume(),s.setControlActive(!0)):(s.stop(),s.freeze(),s.setControlActive(!1))):(s.start(),s.setControlActive(!0))},this.stop=function(){this.freeze();for(var e=this.flakes.length;e--;)this.flakes[e].o.style.display="none";removeEvent(window,"scroll",s.scrollHandler),removeEvent(window,"resize",s.resizeHandler),isIE||(removeEvent(window,"blur",s.freeze),removeEvent(window,"focus",s.resume))},this.show=function(){for(var e=this.flakes.length;e--;)this.flakes[e].o.style.display="block"},this.SnowFlake=function(e,t,n,r){var i=this,o=e;this.type=t,this.x=n||parseInt(rnd(screenX-20)),this.y=isNaN(r)?-rnd(screenY)-12:r,this.vX=null,this.vY=null,this.vAmpTypes=[2,1,1.25,1,1.5,1.75],this.vAmp=this.vAmpTypes[this.type],this.active=1,this.o=document.createElement("img"),this.o.style.position="absolute",this.o.style.width=flakeWidth+"px",this.o.style.height=flakeHeight+"px",this.o.style.fontSize="1px",this.o.style.zIndex=zIndex,this.o.src=imagePath+this.type+(pngSupported&&usePNG?".png":".gif"),docFrag.appendChild(this.o),this.refresh=function(){i.o.style.left=i.x+"px",i.o.style.top=i.y+"px"},this.stick=function(){noFixed||targetElement!=document.documentElement&&targetElement!=document.body?i.o.style.top=screenY+scrollY-flakeHeight-o.terrain[Math.floor(i.x)]+"px":(i.o.style.display="none",i.o.style.top="auto",i.o.style.bottom="0px",i.o.style.position="fixed",i.o.style.display="block")},this.vCheck=function(){i.vX>=0&&i.vX<.2?i.vX=.2:i.vX<0&&i.vX>-.2&&(i.vX=-.2),i.vY>=0&&i.vY<.2&&(i.vY=.2)},this.move=function(){var e=i.vX*windOffset;i.x+=e,i.y+=i.vY*i.vAmp,e>=0&&(i.x>=screenX||screenX-i.x<flakeWidth+1)?i.x=0:0>e&&i.x-flakeLeftOffset<0-flakeWidth&&(i.x=screenX-flakeWidth-1),i.refresh();var t=screenY+scrollY-i.y-o.terrain[Math.floor(i.x)];if(flakeHeight>t){if(i.active=0,snowCollect&&snowStick)for(var n=[.75,1.5,.75],r=0;2>r;r++)o.terrain[Math.floor(i.x)+r+2]+=n[r];i.o.style.left=100*(i.x/screenX)+"%",flakeBottom||(snowStick?i.stick():i.recycle())}},this.animate=function(){i.move()},this.setVelocities=function(){i.vX=vRndX+rnd(.12*vMaxX,.1),i.vY=vRndY+rnd(.12*vMaxY,.1)},this.recycle=function(){i.o.style.display="none",i.o.style.position="absolute",i.o.style.bottom="auto",i.setVelocities(),i.vCheck(),i.x=parseInt(rnd(screenX-flakeWidth-20)),i.y=parseInt(-1*rnd(screenY))-flakeHeight,i.o.style.left=i.x+"px",i.o.style.top=i.y+"px",i.o.style.display="block",i.active=1},this.recycle(),this.refresh()},this.snow=function(){for(var active=0,used=0,waiting=0,i=s.flakes.length;i--;)1==s.flakes[i].active?(s.flakes[i].move(),active++):0==s.flakes[i].active?used++:waiting++;if(snowCollect&&!waiting&&s.createSnow(flakesMaxActive,!0),flakesMaxActive>active)with(s.flakes[parseInt(rnd(s.flakes.length))])snowCollect||0!=active?-1==active&&(active=1):recycle()},this.mouseMove=function(e){if(!followMouse)return!0;var t=parseInt(e.clientX);screenX2>t?windOffset=-windMultiplier+t/screenX2*windMultiplier:(t-=screenX2,windOffset=t/screenX2*windMultiplier)},this.createSnow=function(e,t){for(var n=0;e>n;n++)s.flakes[s.flakes.length]=new s.SnowFlake(s,parseInt(rnd(flakeTypes))),(t||n>flakesMaxActive)&&(s.flakes[s.flakes.length-1].active=-1);targetElement.appendChild(docFrag)},this.timerInit=function(){s.timers=isWin9X?[setInterval(s.snow,75),setInterval(s.snow,25)]:[setInterval(s.snow,20)]},this.init=function(){for(var e=0;2048>e;e++)s.terrain[e]=0;s.randomizeWind(),s.createSnow(snowCollect?flakesMaxActive:2*flakesMaxActive),addEvent(window,"resize",s.resizeHandler),addEvent(window,"scroll",s.scrollHandler),isIE||(addEvent(window,"blur",s.freeze),addEvent(window,"focus",s.resume)),s.resizeHandler(),s.scrollHandler(),followMouse&&addEvent(document,"mousemove",s.mouseMove),s.timerInit()};var didInit=!1;this.start=function(e){if(didInit){if(e)return!0}else didInit=!0;if("string"==typeof targetElement&&(targetElement=document.getElementById(targetElement),!targetElement))throw new Error("Snowstorm: Unable to get targetElement");targetElement||(targetElement=isIE?document.body:document.documentElement?document.documentElement:document.body),targetElement!=document.documentElement&&targetElement!=document.body&&(s.resizeHandler=s.resizeHandlerAlt),s.resizeHandler(),screenX&&screenY&&!s.disabled&&(s.init(),s.active=!0)},document.addEventListener?(document.addEventListener("DOMContentLoaded",function(){s.start(!0)},!1),window.addEventListener("load",function(){s.start(!0)},!1)):addEvent(window,"load",function(){s.start(!0)})}var snowStorm=null;snowStorm=new SnowStorm;
